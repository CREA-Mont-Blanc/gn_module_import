<div class="card main">
    <div class="card-body">
        <div class="row">
            <div class="col-12 col-lg-6">
                <div class="card content">
                    <div class="card-body">
                        <h5 class="card-title">Rapport d'import : {{ import?.id_import }} </h5>
                        <p class="card-text"><b>Jeu de données : </b>{{ import?.dataset_name }} </p>
                        <p class="card-text"><b>Fichier : </b>{{import?.full_file_name}} </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-6">
                        <div class="card content">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-9">
                                        <h4 class="card-title">Observations importées</h4>
                                        <div class="d-flex justify-content-center">
                                            <h4>({{import?.import_count || 0}} ligne(s)
                                                /
                                                {{import?.source_count}}) 
                                            </h4>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <span class="material-icons md-60">
                                            location_on
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6">
                        <div class="card content">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-9">
                                        <h5 class="card-title">Taxons importés</h5>
                                        <div class="d-flex justify-content-center">
                                            <h4>{{ import?.taxa_count }}
                                            </h4>
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <span class="material-icons md-60">
                                            emoji_nature
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card content">
                    <div class="card-body">
                        <h5 class="card-title">Description de l'import</h5>
                        <div class="row">
                            <div class="col-6">
                                <p> <b>Date de soumission de l'import :  </b> {{import?.date_create_import | date:'dd/MM/yyyy'}}  </p>
                                <p> <b>Auteur :  </b> {{import?.author_name}} </p>
                                <p> <b>Nombre de lignes importées :  </b>
                                    ({{import?.import_count || 0}}
                                    /
                                    {{import?.source_count}}) </p>
                            </div>
                            <div class="col-6">
                                <p> <b> SRID : </b>  {{import?.srid}} </p>
                                <p><b> Encodage :</b>  {{import?.encoding}} </p>
                                <p><b>  Format : </b>{{import?.format_source_file}} </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card content">
                    <div class="card-body">
                        <h5 class="card-title">Correspondances</h5>
                        <mat-expansion-panel>
                            <mat-expansion-panel-header [collapsedHeight]="expansionPanelHeight">
                                <mat-panel-title>
                                    <h6> Champs ({{ fields?.length || 0 }} correspondance(s))
                                    </h6>
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Champ source</th>
                                        <th>Champ cible</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let field of fields">
                                        <td> {{ field.source_field }}</td>
                                        <td> {{ field.target_field }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </mat-expansion-panel>
                        <mat-expansion-panel>
                            <mat-expansion-panel-header [collapsedHeight]="expansionPanelHeight">
                                <mat-panel-title>
                                    <h6> Nomenclature ({{ nomenclature?.length || 0 }} correspondance(s))
                                    </h6>
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                        </mat-expansion-panel>
                    </div>
                </div>
                <div class="card content">
                    <div class="card-body">
                        <h5 class="card-title">Données non importées - Erreurs</h5>
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>Type d'erreur</th>
                                    <th>Champ </th>
                                    <th>Description erreur</th>
                                    <th>Nombre d'erreur(s)</th>
                                    <th>Numéro des lignes en erreur </th>
                                </tr>
                
                            </thead>
                            <tbody>
                                <tr *ngFor="let i of import?.errors">
                                    <td> {{i.error_type}} </td>
                                    <td> {{i.column_error}} </td>
                                    <td> {{i.error_description}} <i> <br> {{i.comment}}</i> </td>
                                    <td> <span *ngIf="i?.id_rows && i?.id_rows.length > 0">{{i?.id_rows.length}} </span>  </td>
                                    <td> {{i.id_rows.join(', ')}} </td>
                                </tr>
                            </tbody>
                        </table>
                        <div
                        class="d-flex flex-row-reverse"
                        *ngIf="import?.errors.length"
                    >
                        <button
                            class="btn btn-secondary"
                            (click)="_csvExport.onCSV(import?.id_import)"
                        > Exporter vos {{ import?.errors.length }} observations invalides </button>
                    </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card content">
                    <div class="card-body">
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-secondary">Export PDF</button>
                            <button class="btn btn-secondary">Exporter les 
                                correspondances</button>
                            <button class="btn btn-secondary">Correspondances 
                                d’identifiants</button>
                        </div>
                    </div>
                </div>
                <div class="card content">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-8">
                                <h5 class="card-title">Périmètre géographique 
                                des données importées</h5>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-secondary"
                                 (click)="goToSynthese(import?.id_dataset)">Afficher dans la synthèse</button>
                            </div>
                        </div>    
                    
                        <pnx-map
                            height="40vh"
                            searchBar="false"
                        >
                            <pnx-geojson
                                [geojson]="this.validBbox"
                                [zoomOnFirstTime]="true"
                            >
                            </pnx-geojson>
                        </pnx-map>
                    </div>
                </div>
                <div class="card content">
                    <div class="card-body">
                        <h5 class="card-title">
                            Répartition des taxons importés (Top {{ maxTaxa }})
                        </h5>
                        <div style="display: block">
                            <canvas baseChart
                                [data]="doughnutChartData"
                                [labels]="doughnutChartLabels"
                                [chartType]="doughnutChartType"
                                [colors]="doughnutChartColors"
                                [options]="options">
                            </canvas>
                          </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
